{
  "id": "post_318",
  "title": "Creating a Custom Amazon AMI for Faster Deployments",
  "summary": "Chef is a great tool for automating deployment. But the bootstrap process is hard to get right. Sometimes it can just be easier to start with a system that’s already configured close to your needs. Setup 64-bit 2011.09 Amazon Linux with EBS boot Nginx latest stable Ruby 1.9.3 First launch an instance from the AWS…",
  "body": "<p>\r\n\tChef is a great tool for automating deployment. But the bootstrap process is hard to get right. Sometimes it can just be easier to start with a system that’s already configured close to your needs.</p><h3>Setup</h3><ul><li>64-bit 2011.09 Amazon Linux with EBS boot</li><li>Nginx latest stable</li><li>Ruby 1.9.3</li></ul><p>\r\n\tFirst launch an instance from the AWS Management Console. I am using&nbsp;amzn-ami-2011.09.2.x86_64-ebs (ami-1b814f72) as the image.</p>\r\n<pre>$ ssh ~/.ec2/yourkey ec2-user@ec2-12-34-56-78.compute-1.amazonaws.com\r\n$ sudo su\r\n$ yum update -y\r\n$ yum install -y openssl-devel zlib-devel gcc gcc-c++ make autoconf readline-devel curl-devel expat-devel gettext-devel pcre-devel\r\n$ wget <a href=\"&lt;a href=\" http:=\"\" nginx.org=\"\" download=\"\" nginx-1.0.14.tar.gz\"=\"\"></a><a href=\"http://nginx.org/download/nginx-1.0.14.tar.gz&lt;/a&gt;\"><a\">http://nginx.org/download/nginx-1.0.14.tar.gz&lt;/a&gt;\"...</a\"></a> href=\"<a href=\"http://nginx.org/download/nginx-1.0.14.tar.gz\">htt...\"&gt;http://nginx.org/download/nginx-1.0.14.tar.gz\"&gt;htt...</a>\"&gt;<a href=\"http://nginx.org/download/nginx-1.0.14.tar.gz\">htt...\"&gt;http://nginx.org/download/nginx-1.0.14.tar.gz\"&gt;htt...</a> $ tar xvzf nginx-1.0.14.tar.gz\r\n$ cd nginx-1.0.14\r\n$ ./configure --sbin-path=/usr/local/sbin --with-http_ssl_module\r\n$ make\r\n$ make install\r\n</pre><p>\r\n\tNow you will probably want an init script. <a href=\"http://articles.slicehost.com/2009/2/2/centos-adding-an-nginx-init-script\">This Slicehost article</a> is a bit old but still works beautifully. Start at the “Init Script” section.</p><p>\r\n\tNow for ruby, install yaml for psych, and then compile ruby from source:</p>\r\n<pre>$ wget <a href=\"&lt;a href=\" http:=\"\" pyyaml.org=\"\" download=\"\" libyaml=\"\" yaml-0.1.4.tar.gz\"=\"\"></a><a href=\"http://pyyaml.org/download/libyaml/yaml-0.1.4.tar...&lt;/a&gt;\"><a\">http://pyyaml.org/download/libyaml/yaml-0.1.4.tar....</a\"></a> href=\"<a href=\"http://pyyaml.org/download/libyaml/yaml-0.1.4.tar....\">http://pyyaml.org/download/libyaml/yaml-0.1.4.tar....</a>\"&gt;<a href=\"http://pyyaml.org/download/libyaml/yaml-0.1.4.tar....\">http://pyyaml.org/download/libyaml/yaml-0.1.4.tar....</a> $ tar xzvf yaml-0.1.4.tar.gz\r\n$ cd yaml-0.1.4\r\n$ ./configure --prefix=/usr/local\r\n$ make &amp;&amp; make install\r\n$ wget <a href=\"&lt;a href=\" http:=\"\" ftp.ruby-lang.org=\"\" pub=\"\" ruby=\"\" 1.9=\"\" ruby-1.9.3-p125.tar.gz\"=\"\"></a><a href=\"http://pyyaml.org/download/libyaml/yaml-0.1.4.tar...&lt;/a&gt;\"><a\">http://pyyaml.org/download/libyaml/yaml-0.1.4.tar....</a\"></a> href=\"<a href=\"http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p...\">http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p...</a>\"&gt;<a href=\"http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p...\">http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p...</a> $ tar xvzf ruby-1.9.3-p125.tar.gz\r\n$ cd ruby-1.9.3-p125\r\n$ ./configure --prefix=/usr/local --disable-install-doc --with-opt-dir=/usr/local/lib\r\n$ make &amp;&amp; make install\r\n$ /usr/local/bin/gem install bundler\r\n</pre><p>\r\n\tNow clean up:</p>\r\n<pre>$ rm -rf ruby* nginx* yaml*\r\n$ cd /var/log\r\n$ &gt; cron\r\n$ &gt; maillog \r\n$ &gt; secure\r\n$ &gt; spooler \r\n$ &gt; yum.log \r\n$ rm ~/.bash_history\r\n$ exit\r\n</pre><p>\r\n\tNow we’re ready to create the image. Right click on the EC2 instance in the AWS control panel and choose “Create Image (EBS AMI)”. Give it a name and description and then click “create”. Now choose the AMIs tab on the left. You should see the new AMI in the “pending” status.</p><p><em>Did you enjoy this article? Then you might also like&nbsp;</em><a href=\"http://smashingboxes.com/_/ef448\">How to Convert EC2 AMI to VMDK for Vagrant</a>.</p><p><em><a href=\"http://smashingboxes.com/work\" style=\"background-color: initial;\"></a>Cover photo by&nbsp;</em><a href=\"http://spltt.tumblr.com/\" style=\"background-color: initial;\"><em>Sam</em></a></p>",
  "slug": "creating-a-custom-amazon-ami-for-faster-deployments",
  "slug_history": "--- []\n",
  "visits": 1050,
  "published": "2012-03-27T08:00:00+00:00",
  "authorName": "Reed Law",
  "category_id": 1,
  "image_uid": "2014/07/29/17/22/38/241/file",
  "created_at": "2014-06-05T18:25:27+00:00",
  "updated_at": "2014-12-18T23:04:58+00:00",
  "markdown": "",
  "image_alt_text": null,
  "featured": false,
  "database_id": 318,
  "category": {
    "type": "Entry",
    "id": "category_1"
  },
  "authors": [
    {
      "type": "employee",
      "id": "employee_18"
    },
    {
      "type": "employee",
      "id": "employee_18"
    }
  ]
}